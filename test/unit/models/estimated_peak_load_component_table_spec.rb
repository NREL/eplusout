require_relative '../../test_helper'

include EPlusOut::Models

describe EstimatedPeakLoadComponentTable do
  let(:table) {
    data = JSON.parse('{"name":"Default Zone_50","doas_direct_to_zone":{"percent_grand_total":0.0,"latent":0.0,"related_area":null,"sensible_delayed":null,"sensible_instant":0.0,"sensible_return_air":null,"total":0.0,"total_per_area":null},"equipment":{"percent_grand_total":13.17,"latent":0.0,"related_area":7.93,"sensible_delayed":0.0,"sensible_instant":110.92,"sensible_return_air":null,"total":110.92,"total_per_area":13.99},"exterior_floor":{"percent_grand_total":0.0,"latent":null,"related_area":0.0,"sensible_delayed":0.0,"sensible_instant":null,"sensible_return_air":null,"total":0.0,"total_per_area":null},"exterior_wall":{"percent_grand_total":0.0,"latent":null,"related_area":0.0,"sensible_delayed":0.0,"sensible_instant":null,"sensible_return_air":null,"total":0.0,"total_per_area":null},"fenestration_conduction":{"percent_grand_total":0.0,"latent":null,"related_area":0.0,"sensible_delayed":null,"sensible_instant":0.0,"sensible_return_air":null,"total":0.0,"total_per_area":null},"fenestration_solar":{"percent_grand_total":0.0,"latent":null,"related_area":0.0,"sensible_delayed":0.0,"sensible_instant":null,"sensible_return_air":null,"total":0.0,"total_per_area":null},"grand_total":{"percent_grand_total":null,"latent":27.55,"related_area":null,"sensible_delayed":517.66,"sensible_instant":297.0,"sensible_return_air":0.0,"total":842.2,"total_per_area":null},"ground_contact_floor":{"percent_grand_total":0.0,"latent":null,"related_area":0.0,"sensible_delayed":0.0,"sensible_instant":null,"sensible_return_air":null,"total":0.0,"total_per_area":null},"ground_contact_wall":{"percent_grand_total":0.0,"latent":null,"related_area":0.0,"sensible_delayed":0.0,"sensible_instant":null,"sensible_return_air":null,"total":0.0,"total_per_area":null},"hvac_equipment_loss":{"percent_grand_total":0.0,"latent":null,"related_area":null,"sensible_delayed":0.0,"sensible_instant":0.0,"sensible_return_air":null,"total":0.0,"total_per_area":null},"infiltration":{"percent_grand_total":0.0,"latent":0.0,"related_area":0.0,"sensible_delayed":null,"sensible_instant":0.0,"sensible_return_air":null,"total":0.0,"total_per_area":null},"interzone_ceiling":{"percent_grand_total":0.0,"latent":null,"related_area":0.0,"sensible_delayed":0.0,"sensible_instant":null,"sensible_return_air":null,"total":0.0,"total_per_area":null},"interzone_floor":{"percent_grand_total":-5.1,"latent":null,"related_area":7.93,"sensible_delayed":-42.8,"sensible_instant":null,"sensible_return_air":null,"total":-42.8,"total_per_area":-5.4},"interzone_mixing":{"percent_grand_total":0.0,"latent":0.0,"related_area":null,"sensible_delayed":null,"sensible_instant":0.0,"sensible_return_air":null,"total":0.0,"total_per_area":null},"interzone_wall":{"percent_grand_total":-2.7,"latent":null,"related_area":37.95,"sensible_delayed":-22.9,"sensible_instant":null,"sensible_return_air":null,"total":-22.9,"total_per_area":-0.6},"lights":{"percent_grand_total":10.13,"latent":null,"related_area":7.93,"sensible_delayed":0.0,"sensible_instant":85.32,"sensible_return_air":0.0,"total":85.32,"total_per_area":10.76},"opaque_door":{"percent_grand_total":-0.3,"latent":null,"related_area":1.88,"sensible_delayed":-2.4,"sensible_instant":null,"sensible_return_air":null,"total":-2.4,"total_per_area":-1.3},"other_floor":{"percent_grand_total":0.0,"latent":null,"related_area":7.93,"sensible_delayed":0.0,"sensible_instant":null,"sensible_return_air":null,"total":0.0,"total_per_area":0.0},"other_roof":{"percent_grand_total":0.0,"latent":null,"related_area":7.93,"sensible_delayed":0.0,"sensible_instant":null,"sensible_return_air":null,"total":0.0,"total_per_area":0.0},"other_wall":{"percent_grand_total":0.0,"latent":null,"related_area":0.0,"sensible_delayed":0.0,"sensible_instant":null,"sensible_return_air":null,"total":0.0,"total_per_area":null},"people":{"percent_grand_total":15.92,"latent":58.61,"related_area":7.93,"sensible_delayed":24.15,"sensible_instant":51.29,"sensible_return_air":null,"total":134.05,"total_per_area":16.91},"power_generation_equipment":{"percent_grand_total":0.0,"latent":null,"related_area":null,"sensible_delayed":0.0,"sensible_instant":0.0,"sensible_return_air":null,"total":0.0,"total_per_area":null},"refrigeration":{"percent_grand_total":0.0,"latent":0.0,"related_area":7.93,"sensible_delayed":null,"sensible_instant":0.0,"sensible_return_air":0.0,"total":0.0,"total_per_area":0.0},"roof":{"percent_grand_total":66.69,"latent":null,"related_area":7.93,"sensible_delayed":561.65,"sensible_instant":null,"sensible_return_air":null,"total":561.65,"total_per_area":70.86},"water_use_equipment":{"percent_grand_total":0.0,"latent":0.0,"related_area":7.93,"sensible_delayed":null,"sensible_instant":0.0,"sensible_return_air":null,"total":0.0,"total_per_area":0.0},"zone_ventilation":{"percent_grand_total":2.19,"latent":-31.1,"related_area":null,"sensible_delayed":null,"sensible_instant":49.47,"sensible_return_air":null,"total":18.41,"total_per_area":null}}')
    EstimatedPeakLoadComponentTable.json_create(data)
  }

  describe "#set_estimated_peak_load_component" do
    it "normalizes the table when a load is added" do
      # table.zone_ventilation = EstimatedPeakLoadComponent.new(2.19, -31.1, 0, 0, 49.47, 0, 18.41, 0)
      puts table.grand_total
      table.normalize
      puts table.grand_total
      new_load = EstimatedPeakLoadComponent.new(2.19, 50, 50, 100, 10, 0, 38, 0)

      table.set_estimated_peak_load_component(:zone_ventilation, new_load)

      puts table.grand_total
    end
  end
end

